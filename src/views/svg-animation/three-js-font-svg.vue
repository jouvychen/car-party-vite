<template>
  <div class="three-js--font">
    <div class="svg">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="none" version="1.1" width="581" height="190" viewBox="0 0 581 190">
        <defs>
          <filter id="master_svg_0" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB" x="-2" y="-1" width="69" height="191">
            <feFlood flood-opacity="0" result="BackgroundImageFix"/>
            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"/><feOffset dy="1" dx="0"/>
            <feGaussianBlur stdDeviation="1"/>
            <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
            <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow"/>
            <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape"/>
          </filter>
          <filter id="master_svg_1" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB" x="63" y="0" width="96" height="191">
            <feFlood flood-opacity="0" result="BackgroundImageFix"/>
            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"/><feOffset dy="1" dx="0"/>
            <feGaussianBlur stdDeviation="1"/>
            <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
            <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow"/>
            <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape"/>
          </filter>
          <filter id="master_svg_2" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB" x="155" y="0" width="85" height="191">
            <feFlood flood-opacity="0" result="BackgroundImageFix"/>
            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"/>
            <feOffset dy="1" dx="0"/>
            <feGaussianBlur stdDeviation="1"/>
            <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
            <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow"/>
            <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape"/>
          </filter>
          <filter id="master_svg_3" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB" x="236" y="2" width="94" height="191">
            <feFlood flood-opacity="0" result="BackgroundImageFix"/>
            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"/>
            <feOffset dy="1" dx="0"/>
            <feGaussianBlur stdDeviation="1"/>
            <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
            <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow"/>
            <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape"/>
          </filter>
          <filter id="master_svg_4" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB" x="326" y="0" width="94" height="191">
            <feFlood flood-opacity="0" result="BackgroundImageFix"/>
            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"/>
            <feOffset dy="1" dx="0"/>
            <feGaussianBlur stdDeviation="1"/>
            <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
            <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow"/>
            <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape"/>
          </filter>
          <filter id="master_svg_5" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB" x="416" y="-1" width="81" height="191">
            <feFlood flood-opacity="0" result="BackgroundImageFix"/>
            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"/>
            <feOffset dy="1" dx="0"/>
            <feGaussianBlur stdDeviation="1"/>
            <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
            <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow"/>
            <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape"/>
          </filter>
          <filter id="master_svg_6" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB" x="493" y="-1" width="90" height="191">
            <feFlood flood-opacity="0" result="BackgroundImageFix"/>
            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"/>
            <feOffset dy="1" dx="0"/>
            <feGaussianBlur stdDeviation="1"/>
            <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
            <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow"/>
            <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow" result="shape"/>
          </filter>
        </defs>

<!--        <linearGradient id="blue-fill" x1="0.5" y1="1" x2="0.5" y2="0">-->
<!--          <stop offset="100%" stop-opacity="1" stop-color="blue">-->
<!--            <animate attributeName="offset" values="0;1" repeatCount="1" dur="3s" begin="0s"/>-->
<!--          </stop>-->
<!--          <stop offset="100%" stop-opacity="0.5" stop-color="green">-->
<!--            <animate attributeName="offset" values="0;1" repeatCount="1" dur="3s"  begin="0s"/>-->
<!--          </stop>-->
<!--        </linearGradient>-->

<!--        开始绿色背景，蓝色填充，结果渐变-->
<!--        <linearGradient id="blue-fill" x1="0.5" y1="1" x2="0.5" y2="0">-->
<!--          <stop offset="0" stop-opacity="1" stop-color="blue">-->
<!--            <animate attributeName="offset" values="0;1" repeatCount="1" dur="3s" begin="0s"/>-->
<!--          </stop>-->
<!--          <stop offset="1" stop-opacity="0.5" stop-color="green">-->
<!--            <animate attributeName="offset" values="0;1" repeatCount="1" dur="3s"  begin="0s"/>-->
<!--          </stop>-->
<!--        </linearGradient>-->
<!--        #94deeb   #2E5EB2-->

        <linearGradient id="blue-fill" x1="0.5" y1="1" x2="0.5" y2="0">
          <!--结果色-->
          <stop offset="100%" stop-opacity="1" stop-color="#94deeb">
            <animate attributeName="offset" :values="'0;' + key" repeatCount="1" :dur="second" begin="0s"/>
          </stop>
          <!--底色-->
          <stop offset="100%" stop-opacity="1" stop-color="#2E5EB2">
            <animate attributeName="offset" :values="'0;' + key" repeatCount="1" :dur="second"  begin="0s"/>
          </stop>
        </linearGradient>

        <path d="M19.5781,64.3438L16.8438,60L47.2344,60L45.3594,73L62.5,73L59.6094,86.9375L43.625,86.9375L38.875,120.062L52.7031,120.062L49.9688,134L19.5781,134Q15.4062,134,12.8125,131.266Q10.2188,128.516,11.2344,124.344L16.8438,86.9375L5.76562,86.9375L7.20312,73L18.4375,73L19.5781,64.3438Z" :fill="key === 0 ?'#2E5EB2':'url(#blue-fill)'" fill-opacity="1"/>
        <path d="M110.7969,45L106.7656,74L150.9688,74L142.6094,135L114.9688,135L121.875,87.9375L105.3125,87.9375L98.4062,135L70.76562,135L83.1406,49.1875L80.4062,45L110.7969,45Z" :fill="key === 0 ?'#2E5EB2':'url(#blue-fill)'" fill-opacity="1"/><!-- </g> -->
        <path d="M195.875,74L193.1406,93.375L212.5781,74L240.2344,74L193.1406,115.641L190.4062,135L162.76562,135L170.8281,78.0469L167.9375,74L195.875,74Z" :fill="key === 0 ?'#2E5EB2':'url(#blue-fill)'" fill-opacity="1"/>
        <path d="M317.2969,111.938L273.0781,111.938L271.6406,123.062L310.375,123.062L317.2969,117.578L313.1094,137L252.3438,137Q248.1719,137,246.07812,134.234Q244,131.469,244,127.266L250.9062,76L322.7656,76L317.2969,111.938ZM277.1094,89.9375L275.8125,98L292.375,98L293.8125,89.9375L277.1094,89.9375Z" :fill="key === 0 ?'#2E5EB2':'url(#blue-fill)'" fill-opacity="1"/>
        <path d="M407.2969,109.938L363.0781,109.938L361.6406,121.062L400.375,121.062L407.2969,115.578L403.1094,135L342.3438,135Q338.1719,135,336.07812,132.234Q334,129.469,334,125.266L340.9062,74L412.7656,74L407.2969,109.938ZM367.1094,87.9375L365.8125,96L382.375,96L383.8125,87.9375L367.1094,87.9375Z" :fill="key === 0 ?'#2E5EB2':'url(#blue-fill)'" fill-opacity="1"/>
        <path d="M452.7031,120.062L461.0625,57.5156L456.875,52L488.7031,52L479.0625,124.312Q477.9062,128.5,475.0156,131.25Q472.1406,134,467.9688,134L422.3125,134L425.0625,114.562L430.6719,120.062L452.7031,120.062Z" :fill="key === 0 ?'#2E5EB2':'url(#blue-fill)'" fill-opacity="1"/>
        <path d="M543.6719,120.062L544.9688,110L503.5,110L509.1094,73L575.3594,73L572.6094,90.75L548.7188,90.75L549.1406,86.9375L532.5781,86.9375L531.1406,96.0625L571.3125,96.0625L568.4375,124.203Q567.4375,128.438,563.8281,131.219Q560.2344,134,556.0625,134L500.76562,134L503.5,114.359L507.6719,120.062L543.6719,120.062Z" :fill="key === 0 ?'#2E5EB2':'url(#blue-fill)'" fill-opacity="1"/>

<!--        <style type="text/css">-->
<!--          .st0{stroke:#000;stroke-miterlimit:10;}-->
<!--          .st1{stroke:#000;stroke-miterlimit:10;}-->
<!--        </style>-->

<!--        <linearGradient id="blue-fill" x1="0.5" y1="1" x2="0.5" y2="0">-->
<!--          <stop offset="100%" stop-opacity="1" stop-color="blue">-->
<!--            <animate attributeName="offset" values="0;1" repeatCount="1" dur="3s" begin="0s"/>-->
<!--          </stop>-->
<!--          <stop offset="100%" stop-opacity="0" stop-color="blue">-->
<!--            <animate attributeName="offset" values="0;1" repeatCount="1" dur="3s"  begin="0s"/>-->
<!--          </stop>-->

<!--        </linearGradient>-->

<!--        <linearGradient id="pink-fill" x1="0.5" y1="1" x2="0.5" y2="0">-->
<!--          <stop offset="0%" stop-opacity="0" stop-color="pink">-->
<!--            <animate attributeName="offset" values="0;1" repeatCount="1" dur="3s" begin="3s" fill="freeze"/>-->
<!--            <animate attributeName="stop-opacity" values="0;1" repeatCount="1" dur="0.1s" begin="3s" fill="freeze"/>-->

<!--          </stop>-->
<!--          <stop offset="100%" stop-opacity="0" stop-color="pink">-->
<!--            <animate attributeName="offset" values="0;1" repeatCount="1" dur="3s"  begin="3s" fill="freeze" />-->
<!--            <animate attributeName="stop-opacity" values="0;1" repeatCount="1" dur="3s" begin="6s" fill="freeze"/>-->


<!--          </stop>-->

<!--        </linearGradient>-->


<!--        <g id="XMLID_1_">-->
<!--          <path fill="url(#blue-fill)" id="XMLID_4_" class="st0" d="M147.4,71.3L0.8,67.3c-0.2,2.2-0.3,4.4-0.3,6.7c0,40.6,32.9,73.5,73 .5,73.5s73.5-32.9,73.5-73.5-->
<!--        C147.5,73.1,147.5,72.2,147.4,71.3z"/>-->
<!--          <path fill="url(#pink-fill)" id="XMLID_3_" class="st1" d="M74,0.5C35.7,0.5,4.2,29.8,0.8,67.3l146.6,4.1C146.1,32,113.7,0.5,74,0.5z"/>-->
<!--        </g>-->
      </svg>
    </div>

    <div class="progress">
<!--      {{localSourcesNum}} | {{localHasBeenLoaded}} | {{second}}-->
      <line-rotation-transformation v-if="lineLoading"></line-rotation-transformation>
    </div>
  </div>
</template>
<script>

import { defineComponent, onMounted, ref, watch } from 'vue';
import lineRotationTransformation from './line-rotation-transformation.vue';
export default defineComponent({
  components: {
    lineRotationTransformation
  },
  props: {
    sourcesNum: {
      type: Number,
      default: 0
    },
    hasBeenLoaded: {
      type: Boolean,
      default: false
    }
  },
  setup (props) {
    // 填充速度 = 持续时间second / 增量key， 填充为1时立即填满
    let total = 0;
    const key = ref(0);
    const second = ref(30); // 这个值标签不会接受动态变化，以初始值为标准，所以只能改变增量key
    const localSourcesNum = ref(props.sourcesNum);
    const localHasBeenLoaded = ref(props.hasBeenLoaded);
    const lineLoading = ref(false);
    const onUpdateTime = (index) => {
      if (index < 30) {
        key.value = 1;
        total += key.value;
        console.log(index, key.value);
      } else {
        key.value = 30;
        clearInterval();
      }
    };
    onMounted(() => {
      setTimeout(()=>{
        setInterval(onUpdateTime(1), 1000);
        lineLoading.value = true;
      },4000)
    });
    watch(() => props.hasBeenLoaded, () => {
      localHasBeenLoaded.value = props.hasBeenLoaded;
      if (localHasBeenLoaded.value) {
        onUpdateTime(50);
      }
    }, {
      immediate: true
    });
    return {
      key,
      second,
      localSourcesNum,
      localHasBeenLoaded,
      lineLoading,
      onUpdateTime,
    };
  },
});
</script>
<style scoped lang="less">
.three-js--font {
  width: 100%;
  height: 100%;
  background-color: #2c3e50;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;

  .svg {
      animation: moveScale 1.5s ease-in forwards 3.8s;
    }

  .progress {
    transform: translate(-50%, -50%);
    position: absolute;
    left: 50%;
    top: 50%;
  }
}
svg{
  stroke: hsl(189, 68%, 75%);
  stroke-width:1px;
  fill:hsl(189, 68%, 75%, 0%);
  animation: color-change 1s ease-in forwards 3.8s;
}
//每个字母的描边动画执行时间和开始时间不同
//animation: show 持续时间 动画从头到尾的速度是相同的(linear) 向前 开始时间
path:nth-child(1){
  stroke-dasharray: 0;
  stroke-dashoffset: 0;
  animation: show 1s linear forwards;
}
path:nth-child(2){
  stroke-dasharray: 290;
  stroke-dashoffset: 290;
  animation: show 1.6s linear forwards 1s;
}
path:nth-child(3){
  stroke-dasharray: 450;
  stroke-dashoffset: 450;
  animation: show 2s linear forwards 1s;
}
path:nth-child(4){
  stroke-dasharray: 426;
  stroke-dashoffset: 426;
  animation: show 1.6s linear forwards 1s;
}
path:nth-child(5){
  stroke-dasharray: 520;
  stroke-dashoffset: 520;
  animation: show 3s linear forwards 1s;
}
path:nth-child(6){
  stroke-dasharray: 420;
  stroke-dashoffset: 420;
  animation: show 3s linear forwards 1s;
}

path:nth-child(7){
  stroke-dasharray: 366;
  stroke-dashoffset: 366;
  animation: show 2.4s linear forwards 1s;
}

path:nth-child(8){
  stroke-dasharray: 560;
  stroke-dashoffset: 560;
  animation: show 2.8s linear forwards 1s;
}
path:nth-child(9){
  stroke-dasharray: 526;
  stroke-dashoffset: 526;
  animation: show 2.4s linear forwards 1s;
}

@keyframes show{
  to{
    stroke-dashoffset: 0;
  }
}
@keyframes color-change{
  to{
    stroke: transparent;
    fill:hsl(189, 68%, 75%)
  }
}

@keyframes moveScale{
  to{
    transform: translateY(-100px) scale(0.6);
  }
}
</style>
